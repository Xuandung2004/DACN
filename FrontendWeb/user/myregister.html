<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Register</title>
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="css/sb-admin-2.min.css" rel="stylesheet">

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
  }

  /* Background trang sức */
  body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('/FrontendWeb/user/images/background-login.png') center/cover no-repeat;
    filter: blur(8px) brightness(0.7);
    z-index: -2;
  }

  /* Gradient overlay */
  body::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.1));
    z-index: -1;
  }

  .login-card {
    max-width: 450px;
    width: 100%;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 15px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .login-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
  }

  .login-card .card-body {
    padding: 40px 30px;
  }

  .login-card h1 {
    font-weight: 600;
    color: #5a2a83;
    margin-bottom: 10px;
    text-align: center;
  }

  .login-card p.subtitle {
    color: #7a6c89;
    text-align: center;
    margin-bottom: 30px;
  }

  .form-control {
    border-radius: 50px;
    padding: 15px 20px;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
  }

  .form-control:focus {
    border-color: #5a2a83;
    box-shadow: 0 0 10px rgba(90, 42, 131, 0.2);
  }

  .btn-login {
    border-radius: 50px;
    padding: 12px;
    font-weight: 500;
    background: linear-gradient(135deg, #8a4fff, #5a2a83);
    border: none;
    color: #fff;
    transition: all 0.3s ease;
  }

  .btn-login:hover {
    background: linear-gradient(135deg, #5a2a83, #8a4fff);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  }

  .link-register {
    color: #5a2a83;
    text-decoration: none;
    font-weight: 500;
  }

  .link-register:hover {
    text-decoration: underline;
  }

  .error-message {
    color: red;
    font-size: 0.8rem;
    margin-left: 10px;
    display: block;
    margin-top: 5px;
  }
  
  /* ĐÃ LOẠI BỎ CSS CHO NÚT ẨN/HIỆN MẬT KHẨU TỰ THÊM */
  /* Chỉ giữ lại style mặc định của input nếu cần */
  .form-control-user {
    /* Đã loại bỏ padding-right: 50px !important; */
    padding-right: 20px; /* Hoặc giá trị mặc định của Bootstrap */
  }


  @media (max-width: 576px) {
    .login-card {
      margin: 20px;
    }
  }
</style>

<body>


  <div class="login-card">
    <div class="card-body">
      <h1>Tạo một tài khoản!</h1>
      <p class="subtitle">Đăng ký ngay để có thể truy cập vào trang web và tìm ra trang sức yêu thích của bạn!</p>
      <form id="registerForm" class="user">
        <div class="form-group">
          <input type="text" class="form-control form-control-user" id="username" placeholder="Tên đăng nhập" required>
          <span class="error-message" id="username-error"></span>
        </div>
        <div class="form-group">
          <input type="text" class="form-control form-control-user" id="fullname" placeholder="Họ tên đầy đủ" required>
          <span class="error-message" id="fullname-error"></span>
        </div>
        <div class="form-group">
          <input type="email" class="form-control form-control-user" id="email" placeholder="Địa chỉ Email" required>
          <span class="error-message" id="email-error"></span>
        </div>
        <div class="form-group">
          <input type="text" class="form-control form-control-user" id="phone" placeholder="Số điện thoại" required>
          <span class="error-message" id="phone-error"></span>
        </div>
        
        <div class="form-group">
          <input type="password" class="form-control form-control-user" id="password" placeholder="Mật khẩu" required>
          <span class="error-message" id="password-error"></span>
        </div>
        
        <div class="form-group">
          <input type="password" class="form-control form-control-user" id="repeatPassword"
            placeholder="Nhập lại mật khẩu" required>
          <span class="error-message" id="repeatPassword-error"></span>
        </div>
        
        <button type="submit" class="btn btn-login w-100">
          Tạo tài khoản
        </button>
      </form>

      <hr>
      <div class="text-center">
        <a class="link-register" href="myloginfinal1.html">Bạn đã có tài khoản? Đăng nhập!</a>
      </div>
    </div>
  </div>


</body>

</html>

<script>
  // Hàm hiển thị lỗi
  function displayError(id, message) {
    document.getElementById(id + "-error").textContent = message;
  }

  // Hàm xóa lỗi
  function clearErrors() {
    document.querySelectorAll(".error-message").forEach(el => el.textContent = "");
  }

  // Hàm kiểm tra định dạng email
  function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  // Hàm kiểm tra độ mạnh của mật khẩu
  function isValidPassword(password) {
    // Ít nhất 7 ký tự, bao gồm: 1 chữ hoa, 1 chữ thường, 1 số, 1 ký tự đặc biệt
    const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+}{"':;?/>.<,])(.{7,})$/;
    return passwordRegex.test(password);
  }

  // Hàm kiểm tra Họ tên (chấp nhận chữ cái tiếng Việt/Anh và khoảng trắng)
  function isValidFullName(fullname) {
    // Regex chấp nhận chữ cái (a-z, A-Z), khoảng trắng, và các ký tự tiếng Việt có dấu/không dấu
    const nameRegex = /^[a-zA-Z\sàáãạăằắẵặâầấẫậđèéẽẹêềếễệìíĩịòóõọôồốỗộơờớỡợùúũụưừứữựýỳỹỵÀÁÃẠĂẰẮẴẶÂẦẤẪẬĐÈÉẼẸÊỀẾỄỆÌÍĨỊÒÓÕỌÔỒỐỖỘƠỜỚỠỢÙÚŨỤƯỪỨỮỰÝỲỸỴ]+$/;
    return nameRegex.test(fullname);
  }

  // Hàm kiểm tra Số điện thoại (chỉ chứa số, không khoảng trắng, 10-11 số)
  function isValidPhoneNumber(phone) {
    // Regex: chỉ chứa chữ số (0-9), và có độ dài từ 10 đến 11 số
    const phoneRegex = /^[0-9]{10,11}$/; 
    return phoneRegex.test(phone);
  }

  function validateForm() {
    clearErrors(); // Bắt buộc xóa lỗi cũ trước
    let hasError = false; // Theo dõi xem có lỗi nào xảy ra không

    // Lấy giá trị các trường
    const TenDn = document.getElementById("username").value.trim();
    const HoTen = document.getElementById("fullname").value.trim();
    const Email = document.getElementById("email").value.trim();
    const Sdt = document.getElementById("phone").value.trim();
    const MatKhau = document.getElementById("password").value;
    const repeatPassword = document.getElementById("repeatPassword").value;

    // --- 1. BẮT LỖI TRƯỜNG RỖNG ---

    if (TenDn === "") {
      displayError("username", "Tên đăng nhập không được để trống.");
      hasError = true;
    }
    if (HoTen === "") {
      displayError("fullname", "Họ tên không được để trống.");
      hasError = true;
    }
    if (Email === "") {
      displayError("email", "Email không được để trống.");
      hasError = true;
    }
    if (Sdt === "") {
      displayError("phone", "Số điện thoại không được để trống.");
      hasError = true;
    }
    if (MatKhau === "") {
      displayError("password", "Mật khẩu không được để trống.");
      hasError = true;
    }
    if (repeatPassword === "") {
      displayError("repeatPassword", "Vui lòng nhập lại mật khẩu.");
      hasError = true;
    }
    
    // --- 2. BẮT LỖI ĐỊNH DẠNG (Chỉ kiểm tra nếu trường đó KHÔNG RỖNG) ---
    
    // Họ tên
    if (HoTen !== "" && !isValidFullName(HoTen)) {
      displayError("fullname", "Họ tên chỉ được chứa chữ cái và khoảng trắng (bao gồm tiếng Việt có dấu).");
      hasError = true;
    }
    
    // Số điện thoại
    if (Sdt !== "" && !isValidPhoneNumber(Sdt)) {
        displayError("phone", "Số điện thoại không hợp lệ (chỉ chứa 10-11 chữ số, không khoảng trắng, không ký tự).");
        hasError = true;
    }

    // Email
    if (Email !== "" && !isValidEmail(Email)) {
      displayError("email", "Địa chỉ Email không hợp lệ.");
      hasError = true;
    }

    // Mật khẩu (độ mạnh)
    if (MatKhau !== "" && !isValidPassword(MatKhau)) {
      displayError("password", "Mật khẩu phải có ít nhất 7 kí tự, bao gồm: chữ hoa, chữ thường, số và kí tự đặc biệt.");
      hasError = true;
    }

    // --- 3. BẮT LỖI KHỚP MẬT KHẨU ---
    // Chỉ kiểm tra nếu cả hai trường mật khẩu đều đã được nhập
    if (MatKhau !== "" && repeatPassword !== "" && MatKhau !== repeatPassword) {
      displayError("repeatPassword", "Mật khẩu nhập lại không khớp.");
      hasError = true;
    }

    return !hasError; // Trả về true nếu không có lỗi nào
  }


  // ĐÃ LOẠI BỎ LOGIC ẨN/HIỆN MẬT KHẨU TỰ THÊM


  document.getElementById("registerForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    if (!validateForm()) {
      return; // Dừng nếu validation thất bại
    }

    // Nếu validation thành công, thực hiện fetch API
    const TenDn = document.getElementById("username").value.trim();
    const HoTen = document.getElementById("fullname").value.trim();
    const Email = document.getElementById("email").value.trim();
    const Sdt = document.getElementById("phone").value.trim();
    const MatKhau = document.getElementById("password").value;

    try {
      const res = await fetch("http://localhost:5150/api/auth/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ TenDn, MatKhau, Email, Sdt, HoTen })
      });

      const data = await res.json();

      if (res.ok) {
        alert(data.message);
        window.location.href = "/FrontendWeb/user/myloginfinal1.html";
      } else {
        alert(data.message || "Đăng ký thất bại");
      }
    } catch (error) {
      alert("Không thể kết nối đến server");
      console.error(error);
    }
  });
</script>

<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>